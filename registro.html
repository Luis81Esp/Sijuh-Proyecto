<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Usuario - SIJUH</title>
    <link rel="stylesheet" href="dise√±o.css">
</head>
<body>
    <div class="container">
        <h1>Reg√≠strate en SIJUH</h1>
        <form id="registerForm">
            <input type="email" id="email" placeholder="Correo electr√≥nico" required>
            
            <!-- Campo de contrase√±a con el √≠cono de ojo -->
            <div class="password-container">
                <input type="password" id="password" placeholder="Contrase√±a" required>
                <span class="toggle-password" id="togglePassword1">&#128065;</span> <!-- √çcono de ojo -->
            </div>

            <!-- Campo de repetir contrase√±a con el √≠cono de ojo -->
            <div class="password-container">
                <input type="password" id="confirmPassword" placeholder="Repetir Contrase√±a" required>
                <span class="toggle-password" id="togglePassword2">&#128065;</span> <!-- √çcono de ojo -->
            </div>

            <input type="text" id="firstName" placeholder="Nombre" required>
            <input type="text" id="lastName" placeholder="Apellidos" required>
            <input type="text" id="dni" placeholder="DNI" maxlength="8" required>
            <button type="submit">Registrar</button>
        </form>
    </div>

    <script type="module">
        import { auth, db } from './firebaseConfig.js';
        import { createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/9.21.0/firebase-auth.js';
        import { collection, addDoc } from 'https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore.js';

        // Mostrar/Ocultar contrase√±as
        const togglePassword1 = document.getElementById('togglePassword1');
        const passwordField = document.getElementById('password');
        
        togglePassword1.addEventListener('click', function () {
            const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordField.setAttribute('type', type);
            // Cambia el √≠cono
            this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà'; 
        });

        const togglePassword2 = document.getElementById('togglePassword2');
        const confirmPasswordField = document.getElementById('confirmPassword');
        
        togglePassword2.addEventListener('click', function () {
            const type = confirmPasswordField.getAttribute('type') === 'password' ? 'text' : 'password';
            confirmPasswordField.setAttribute('type', type);
            // Cambia el √≠cono
            this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà'; 
        });

        // Validaciones del formulario
        const registerForm = document.getElementById('registerForm');
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const dni = document.getElementById('dni').value;

            // Validar que las contrase√±as coincidan
            if (password !== confirmPassword) {
                alert('Las contrase√±as no coinciden.');
                return;
            }

            // Validar que el DNI tenga 8 n√∫meros
            if (!/^\d{8}$/.test(dni)) {
                alert('El DNI debe tener 8 n√∫meros.');
                return;
            }

            try {
                // Registrar el usuario en Firebase Authentication
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                
                // Guardar los datos adicionales en Firestore
                await addDoc(collection(db, 'users'), {
                    uid: userCredential.user.uid,
                    firstName,
                    lastName,
                    dni,
                    email
                });

                alert('Usuario registrado con √©xito');
                window.location.href = 'index.html'; // Redireccionar a index.html despu√©s del registro
            } catch (error) {
                alert('Error en el registro: ' + error.message);
            }
        });
    </script>
</body>
</html>
    